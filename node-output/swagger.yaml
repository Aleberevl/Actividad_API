openapi: 3.0.3
info:
  title: Rutas de Resúmenes (Fragmento DOF)
  description: |
    Este archivo es un fragmento de la especificación principal del DOF, enfocado
    exclusivamente en las rutas para la gestión de resúmenes generados automáticamente.
  version: 1.0.0
servers:
- url: https://virtserver.swaggerhub.com/tecnologicodemonterr-61b/DOD/1.0.0
  description: SwaggerHub API Auto Mocking
tags:
- name: Procesamiento
  description: Rutas relacionadas con la ejecución de tareas de análisis y resumen automático.
paths:
  /summaries:
    get:
      tags:
      - Procesamiento
      summary: Obtener lista de resúmenes generados
      operationId: getSummaries
      parameters:
      - name: skip
        in: query
        description: Número de registros a omitir para la paginación (offset).
        required: false
        schema:
          minimum: 0
          type: integer
          format: int32
          default: 0
      - name: limit
        in: query
        description: Número máximo de registros a retornar (tamaño de la página).
        required: false
        schema:
          maximum: 100
          minimum: 1
          type: integer
          format: int32
          default: 25
      responses:
        "200":
          description: Lista de resúmenes retornada exitosamente.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Summary"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
    put:
      tags:
      - Procesamiento
      summary: Actualizar un resumen existente
      operationId: updateSummary
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/summaries_body"
        required: true
      responses:
        "200":
          description: Resumen actualizado exitosamente.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Summary"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
    post:
      tags:
      - Procesamiento
      summary: Crear un nuevo resumen
      operationId: createSummary
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/summaries_body_1"
        required: true
      responses:
        "201":
          description: Resumen creado exitosamente.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Summary"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
  /summaries/{summaryId}:
    delete:
      tags:
      - Procesamiento
      summary: Eliminar un resumen por ID
      operationId: deleteSummary
      parameters:
      - name: summaryId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: Resumen eliminado correctamente.
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
  /users:
    get:
      summary: Obtener lista de usuarios
      operationId: getUsers
      responses:
        "200":
          description: Lista de usuarios retornada exitosamente.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/users"
    put:
      summary: Actualizar un usuario existente
      operationId: updateUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/users_body"
        required: true
      responses:
        "200":
          description: Usuario actualizado exitosamente.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/users"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
    post:
      summary: Crear un nuevo usuario
      operationId: createUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/users_body_1"
        required: true
      responses:
        "201":
          description: Usuario creado exitosamente.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/users"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
    delete:
      summary: Eliminar un usuario
      operationId: deleteUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/users_body_2"
        required: true
      responses:
        "204":
          description: Usuario eliminado correctamente.
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
  /publications:
    get:
      tags:
      - Procesamiento
      summary: Obtener lista de publicaciones
      operationId: getPublications
      responses:
        "200":
          description: Lista de publicaciones retornada exitosamente.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Publications"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
    put:
      tags:
      - Procesamiento
      summary: Actualizar una publicación existente
      operationId: updatePublication
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/publications_body"
        required: true
      responses:
        "200":
          description: Publicación actualizada exitosamente.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Publications"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
    post:
      tags:
      - Procesamiento
      summary: Crear una nueva publicación
      operationId: createPublication
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/publications_body_1"
        required: true
      responses:
        "201":
          description: Publicación creada exitosamente.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Publications"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
    delete:
      tags:
      - Procesamiento
      summary: Eliminar una publicación
      operationId: deletePublication
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/publications_body_2"
        required: true
      responses:
        "204":
          description: Publicación eliminada correctamente.
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
components:
  schemas:
    Summary:
      type: object
      properties:
        id:
          type: integer
          description: Identificador único del resumen.
        summary_text:
          type: string
          description: El texto del resumen generado.
        confidence:
          type: number
          description: Puntuación de confianza del modelo.
          format: float
    users:
      title: users
      type: object
      properties:
        table_name:
          type: string
        description:
          type: string
        columns:
          type: array
          items:
            $ref: "#/components/schemas/publications_columns"
        title:
          type: string
      description: Tabla principal para almacenar la información de los usuarios del sistema (administradores y clientes).
      x-examples:
        Example 1:
          table_name: users
          description: Tabla principal para almacenar la información de los usuarios del sistema (administradores y clientes).
          columns:
          - name: id
            type: BIGINT
            constraints:
            - PRIMARY KEY
            - AUTO_INCREMENT
            description: Identificador único del usuario (clave primaria).
          - name: email
            type: VARCHAR(255)
            constraints:
            - NOT NULL
            - UNIQUE
            description: "Correo electrónico del usuario, utilizado para inicio de sesión. Debe ser único."
          - name: password_hash
            type: VARCHAR(255)
            constraints:
            - NOT NULL
            description: Contraseña cifrada (hashed) del usuario. Nunca se almacena en texto plano.
          - name: full_name
            type: VARCHAR(255)
            constraints:
            - NOT NULL
            description: Nombre completo del usuario.
          - name: status
            type: "ENUM('active', 'suspended', 'pending')"
            default: '''pending'''
            description: Estado de la cuenta del usuario.
          - name: role
            type: "ENUM('admin', 'reader', 'processor')"
            default: '''reader'''
            description: "Rol del usuario en el sistema, definiendo sus permisos de acceso."
          - name: created_at
            type: TIMESTAMP
            default: CURRENT_TIMESTAMP
            description: Fecha y hora de registro del usuario.
          - name: last_login_at
            type: TIMESTAMP
            default: "NULL"
            description: Fecha y hora del último inicio de sesión.
          title: Users
    Publications:
      type: object
      properties:
        table_name:
          type: string
        description:
          type: string
        columns:
          type: array
          items:
            $ref: "#/components/schemas/publications_columns"
        title:
          type: string
      x-examples:
        Example 1:
          table_name: summaries
          description: "Tabla para almacenar resúmenes generados automáticamente de objetos del proyecto (publicaciones, secciones, ítems o fragmentos) junto con su modelo, idioma y nivel de confianza."
          columns:
          - name: id
            type: BIGINT
            constraints:
            - PRIMARY KEY
            - AUTO_INCREMENT
            description: Identificador único del resumen (clave primaria).
          - name: object_type
            type: "ENUM('publication', 'section', 'item', 'chunk')"
            constraints:
            - NOT NULL
            description: "Tipo de objeto al que pertenece el resumen (publicación, sección, ítem o fragmento de texto)."
          - name: object_id
            type: BIGINT
            constraints:
            - NOT NULL
            - FOREIGN KEY (referencia a la tabla de la entidad padre)
            description: Identificador del objeto original en su tabla correspondiente (clave foránea).
          - name: model_used
            type: VARCHAR(100)
            constraints:
            - NOT NULL
            description: Nombre del modelo de lenguaje (LLM) utilizado para generar el resumen (ej. ''Gemini-2.5-Pro'').
          - name: lang
            type: VARCHAR(10)
            default: '''es'''
            description: Código ISO del idioma en el que fue generado el resumen (por defecto 'es').
          - name: summary_text
            type: TEXT
            constraints:
            - NOT NULL
            description: Contenido textual completo del resumen generado.
          - name: confidence
            type: "DECIMAL(5,2)"
            description: "Nivel de confianza asociado al resumen, expresado entre 0.00 y 1.00."
          - name: created_at
            type: TIMESTAMP
            default: CURRENT_TIMESTAMP
            description: Fecha y hora de generación del resumen.
          title: Summaries
    summaries_body:
      type: object
      properties:
        id:
          type: integer
        summary_text:
          type: string
        confidence:
          type: number
          format: float
    summaries_body_1:
      type: object
      properties:
        summary_text:
          type: string
        confidence:
          type: number
          format: float
    users_body:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        password_hash:
          type: string
        full_name:
          type: string
        status:
          type: string
          enum:
          - active
          - suspended
          - pending
        role:
          type: string
          enum:
          - admin
          - reader
          - processor
    users_body_1:
      type: object
      properties:
        email:
          type: string
          format: email
        password_hash:
          type: string
        full_name:
          type: string
        status:
          type: string
          default: pending
          enum:
          - active
          - suspended
          - pending
        role:
          type: string
          default: reader
          enum:
          - admin
          - reader
          - processor
    users_body_2:
      type: object
      properties:
        id:
          type: integer
    publications_columns:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        constraints:
          type: array
          items:
            type: string
        description:
          type: string
        default:
          type: string
    publications_body:
      type: object
      properties:
        table_name:
          type: string
        description:
          type: string
        columns:
          type: array
          items:
            $ref: "#/components/schemas/publications_columns"
        title:
          type: string
    publications_body_1:
      type: object
      properties:
        table_name:
          type: string
        description:
          type: string
        columns:
          type: array
          items:
            $ref: "#/components/schemas/publications_columns"
        title:
          type: string
    publications_body_2:
      type: object
      properties:
        table_name:
          type: string
  responses:
    UnauthorizedError:
      description: Acceso no autorizado. Falta el token de autenticación o es inválido.
    NotFoundError:
      description: Recurso no encontrado. El ID proporcionado no existe.
